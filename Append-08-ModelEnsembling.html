
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>附录 H：模型集成 &#8212; Python贝叶斯分析(中文)</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="附录 J：贝叶斯优化" href="Append-09-BayesianOptimization.html" />
    <link rel="prev" title="附录 G：模型平均" href="Append-07-ModelAveraging.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Python贝叶斯分析(中文)</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="preface.html">
   封面
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  书籍正文
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter01-ThinkingProbabilistically.html">
   第 1 章 概率思维
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter02-ProgrammingProbabilistically.html">
   第 2 章 概率编程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter03-ModellingwithLinearRegression.html">
   第 3 章 线性回归模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter04-GeneralizedLinearRegression.html">
   第 4 章 广义线性回归模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter05-ModelComparison.html">
   第 5 章 模型比较与模型平均
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter06-MixtureModels.html">
   第 6 章 混合模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter07-GaussianProcesses.html">
   第 7 章 高斯过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter08-InterefenceEngine.html">
   第 8 章 推断引擎
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter09-WheretoGoNext.html">
   第 9 章 下一步去哪儿？
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  文献阅读
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Append-01-MCMC_Tutorial.html">
   附录 A： MCMC 推断
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Append-02-VariationalInference_Tutorial.html">
   附录 B： 变分法推断
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Append-03-GaussianProcessTutorial_01.html">
   附录 C： 高斯过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Append-04-BayesianNN_Tutorial.html">
   附录 D：贝叶斯神经网络
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Append-05-BayesianDeepLearning_Tutorial.html">
   附录 E：贝叶斯深度学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Append-06-BayesianDeepLearningPymc3.html">
   附录 F：贝叶斯深度学习编程初步
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Append-07-ModelAveraging.html">
   附录 G：模型平均
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   附录 H：模型集成
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Append-09-BayesianOptimization.html">
   附录 J：贝叶斯优化
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Append-10-WorkFlow.html">
   附录 K：贝叶斯工作流程
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/Append-08-ModelEnsembling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Append-08-ModelEnsembling.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/xishansnow/BayesianAnalysiswithPython2nd"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/xishansnow/BayesianAnalysiswithPython2nd/issues/new?title=Issue%20on%20page%20%2FAppend-08-ModelEnsembling.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/xishansnow/BayesianAnalysiswithPython2nd/master?urlpath=lab/tree/Append-08-ModelEnsembling.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https://github.com/xishansnow/BayesianAnalysiswithPython2nd&urlpath=lab/tree/BayesianAnalysiswithPython2nd/Append-08-ModelEnsembling.md&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   1 为什么做模型集成？
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   2 监督分类任务中的主要集成学习方法
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bagging">
     2.1 装袋法（
     <code class="docutils literal notranslate">
      <span class="pre">
       Bagging
      </span>
     </code>
     ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#boosting">
     2.2  提升法（
     <code class="docutils literal notranslate">
      <span class="pre">
       Boosting
      </span>
     </code>
     ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stacking">
     2.3 堆叠法（
     <code class="docutils literal notranslate">
      <span class="pre">
       Stacking
      </span>
     </code>
     ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     2.4 半监督分类任务
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3 聚簇任务中的模型集成
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     3.1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     3.2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     3.3
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   4 深度集成
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     4.1 一般性的深度集成
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#snapshot">
     4.1 快照法（ Snapshot ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fast-geometric-ensembling-fge">
     4.2 快速几何集成法（ fast geometric ensembling, FGE ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stochastic-weight-averaging-swa">
     4.3 随机权重平均法（ stochastic weight averaging, SWA ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lomifoss">
     4.4 LoMiFoSS
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id10">
   6 总结
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>附录 H：模型集成</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   1 为什么做模型集成？
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   2 监督分类任务中的主要集成学习方法
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bagging">
     2.1 装袋法（
     <code class="docutils literal notranslate">
      <span class="pre">
       Bagging
      </span>
     </code>
     ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#boosting">
     2.2  提升法（
     <code class="docutils literal notranslate">
      <span class="pre">
       Boosting
      </span>
     </code>
     ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stacking">
     2.3 堆叠法（
     <code class="docutils literal notranslate">
      <span class="pre">
       Stacking
      </span>
     </code>
     ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     2.4 半监督分类任务
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3 聚簇任务中的模型集成
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     3.1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     3.2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     3.3
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   4 深度集成
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     4.1 一般性的深度集成
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#snapshot">
     4.1 快照法（ Snapshot ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fast-geometric-ensembling-fge">
     4.2 快速几何集成法（ fast geometric ensembling, FGE ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stochastic-weight-averaging-swa">
     4.3 随机权重平均法（ stochastic weight averaging, SWA ）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lomifoss">
     4.4 LoMiFoSS
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id10">
   6 总结
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="h">
<h1>附录 H：模型集成<a class="headerlink" href="#h" title="Permalink to this headline">¶</a></h1>
<p>【摘要】贝叶斯模型平均(贝叶斯模型平均) 提供了一种连贯且系统的机制来解释模型的不确定性。它可以看作是贝叶斯推理在模型选择、组合估计和预测问题上的直接应用。贝叶斯模型平均产生了一个简单的模型选择标准和风险较低的预测。然而，贝叶斯模型平均的应用并不总是直截了当的，导致对其不同方面的不同假设和情境选择。</p>
<p>【原文】Joseph Rocca; <a class="reference external" href="https://towardsdatascience.com/ensemble-methods-bagging-boosting-and-stacking-c9214a10a205">Ensemble methods: bagging, boosting and stacking
Understanding the key concepts of ensemble learning</a>; Apr 23, 2019</p>
<style>p{text-indent:2em;2}</style>
<div class="section" id="id1">
<h2>1 为什么做模型集成？<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>已经了解了机器学习中的多种分类和回归模型。那现在有一个问题就是，哪一个模型最好呢？以分类任务为例，当拿到一个需要进行分类的任务时，如果是你你会选择哪种模型进行建模呢？一个狡猾的办法就是挨个都试一下，那这样做有没有道理呢？还别说，在实际的情况中真的可能会都去试一下，因为在没有实验之前谁都不会知道真正的结果。假如现在对A、C、D这三个模型进行建模，最后得到结果是：A的分类准确率为0.93，B的分类准确率为0.95，C的准确率为0.88。那最终应该选择哪一个模型呢？是模型B吗？</p>
<p><img alt="" src="https://pic2.zhimg.com/80/v2-d36576fbc3ecb1fbd22577372fa6b5b5_720w.jpg" /></p>
<p>假设一共有100个数据样本，数据标签为二分类（正、负两类），如图所示为三个模型的部分分类结果。其中图示中的5个样本，模型A和C均能分类正确，而模型B不能分类正确。如果此时将这三个模型一起用于分类任务的预测，并且对于每一个样本的最终输出结果采用基于投票的规则在三个模型的输出结果中进行选择。例如图示中的第1个样本，模型A和C均判定为“负类”只有B判定为“正类“，则最后的输出便为”负类“。那么此时，就有可能得到一个分类准确率为1的“混合”模型。</p>
<p>注：在其余的95个样本中，假设根据投票规则均能分类正确</p>
</div>
<div class="section" id="id2">
<h2>2 监督分类任务中的主要集成学习方法<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>在机器学习中，基于这种组合思想来提高模型精度的方法被称为<strong>集成学习（ensemble learning）</strong>。俗话说”三个臭皮匠，赛过诸葛亮“，这句话完美的阐述了集成学习的潜在思想——通过将多个弱的模型结合在一起来提高最终结果的预测精度。</p>
<p>常见的集成模型主要包括以下三种：</p>
<ul class="simple">
<li><p><strong>装袋法（  <code class="docutils literal notranslate"><span class="pre">Bagging</span></code> ）</strong>： 装袋法的核心思想为<strong>并行地训练一组各自独立的同质弱学习器</strong>，然后按照某种确定性平均过程将他们组合起来（例如：分类中的投票策略，回归中的平均策略）。</p></li>
<li><p><strong>提升法（ <code class="docutils literal notranslate"><span class="pre">Boosting</span></code> ）</strong>：提升法的核心思想为<strong>串行地训练一组前后适应性的同构弱学习器</strong>，然后按照某种确定性策略组合它们。此处『适应性』指用后一个模型来对前一个模型的输出进行纠正。</p></li>
<li><p><strong>堆叠法（ <code class="docutils literal notranslate"><span class="pre">Stacking</span></code> ）</strong>： <code class="docutils literal notranslate"><span class="pre">Stacking</span></code> 的核心思想为<strong>并行地训练一组各自独立的异构弱学习器</strong>，然后通过训练一个元模型（meta-model）来将各弱学习器组合起来。</p></li>
</ul>
<p>我们可以粗略地说<code class="docutils literal notranslate"><span class="pre">装袋法</span></code>主要专注于获得方差小于其组件的集成模型（过拟合场景）；而<code class="docutils literal notranslate"><span class="pre">提升法</span></code>和<code class="docutils literal notranslate"><span class="pre">堆叠法</span></code>主要尝试生成比其组件偏差更少的强模型（欠拟合场景）。</p>
<p><img alt="" src="https://gitee.com/XiShanSnow/imagebed/raw/master/images/stats-20211221222031-9431.webp" /></p>
<p>可以组合弱学习器以获得性能更好的模型。组合基础模型的方式应该适应它们的类型。低偏差和高方差弱模型应该以一种使强模型更健壮的方式组合，而低方差和高偏差基础模型最好以一种使集成模型更少偏差的方式组合。</p>
<div class="section" id="bagging">
<h3>2.1 装袋法（ <code class="docutils literal notranslate"><span class="pre">Bagging</span></code> ）<a class="headerlink" href="#bagging" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">装袋法（</span> <span class="pre">Bagging</span> <span class="pre">）</span></code>的全称为 <code class="docutils literal notranslate"><span class="pre">自举/聚合（</span> <span class="pre">bootstrap</span> <span class="pre">aggregation</span> <span class="pre">）</span></code>，这两个单词分别代表了装袋法在执行过程中的两个步骤：① 自举样本（bootstrap samples）；② 聚合输出（ aggregate outputs）。也就是装袋法首先从原始数据集中随机抽取多组包含若干数量样本点的子训练集；然后基于这些子训练集分别得到不同的基模型；最后对各基模型预测的结果进行聚合输出。</p>
<div class="math notranslate nohighlight">
\[
y=\frac{1}{M}\sum_{m=1}^Mf_m(x)\tag{1}
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(M\)</span> 表示基模型的数量，<span class="math notranslate nohighlight">\(f_m(x)\)</span> 表示不同的基模型。</p>
<p><img alt="" src="https://gitee.com/XiShanSnow/imagebed/raw/master/images/stats-20211221222045-0c29.webp" /></p>
<p>由于装袋法的策略是取所有基模型的”平均“值作为最终模型的输出结果，因此能够很好的降低模型的高方差（过拟合）状况。通常在使用装袋法时，尽量使每个基模型都出现过拟合的现象。</p>
<p><strong>（1） sklearn 中的装袋法</strong></p>
<p>下面以 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 中实现的<code class="docutils literal notranslate"><span class="pre">BaggingClassifier</span></code>为例，并对其中的参数进行简单的说明一下。在 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 中，可以通过<code class="docutils literal notranslate"><span class="pre">from</span>&#160; <span class="pre">sklearn.ensemble</span> <span class="pre">import</span> <span class="pre">BaggingClassifier</span></code>来导入 <code class="docutils literal notranslate"><span class="pre">bagging</span></code> 集成方法。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">base_estimator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">max_samples</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">max_features</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">bootstrap_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">n_jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>  <span class="n">Input</span> <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
               <span class="o">^</span>
<span class="ne">SyntaxError</span>: unexpected EOF while parsing
</pre></div>
</div>
</div>
</div>
<p>上面的初始化函数是类<code class="docutils literal notranslate"><span class="pre">BaggingClassifier</span></code>中的一部分参数，其中<code class="docutils literal notranslate"><span class="pre">base_estimator</span></code> 表示所使用的基模型；<code class="docutils literal notranslate"><span class="pre">n_estimators</span></code> 表示需要同时训练多少个基模型；<code class="docutils literal notranslate"><span class="pre">max_samples</span></code> 表示每个子训练集中最大的样本数量；<code class="docutils literal notranslate"><span class="pre">max_features</span></code> 表示子训练集的最大特征维度（由于是随机抽样，所以不同的子训练集特征维度可能不一样）; <code class="docutils literal notranslate"><span class="pre">bootstrap=True</span></code> 表示在每个子训练集中同一个样本可以重复出现；<code class="docutils literal notranslate"><span class="pre">bootstrap_features=False</span></code> 表示在每个子训练集中每个特征维度不能重复出现（如果设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> ，极端情况下所有的特征维度可能都一样）。</p>
<p>如下代码所示为以 <code class="docutils literal notranslate"><span class="pre">KNN</span></code> 作为基模型进行装袋法集成的示例用法：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">()</span>
 <span class="n">bagging</span> <span class="o">=</span> <span class="n">BaggingClassifier</span><span class="p">(</span><span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">n_estimators</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                <span class="n">max_samples</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                <span class="n">max_features</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">bootstrap_features</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">bagging</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bagging</span><span class="o">.</span><span class="n">estimators_features_</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bagging</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bagging</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>（2） 随机森林</strong></p>
<p>正如上面说到，在装袋法方法进行模型集成的时候，基模型可以是任意模型，自然而然也也可以是决策树了。由于对决策树使用装袋法方法是一个较为受欢迎的研究方向，因此也给它取了另外一个名字<strong>随机森林（random forests）</strong>。根据装袋法的思想来看，随机森林这个名字也很贴切，一系列的树模型就变成了森林。因此在 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 中，如果是通过<code class="docutils literal notranslate"><span class="pre">BaggingClassifier</span></code>来实现装袋法集成，当 <code class="docutils literal notranslate"><span class="pre">base_estimator=None</span></code> 时，默认就会采用决策树作为基模型。</p>
<p><img alt="" src="https://pic2.zhimg.com/v2-0775c793de4b55e0077edfcc953f2b4d_b.jpg" /></p>
<p><img alt="" src="https://gitee.com/XiShanSnow/imagebed/raw/master/images/stats-20211221222054-f0d1.webp" /></p>
<p>上图为随机采样后生成的若干决策树模型，可以看到，在不同子样本集中训练的决策树中，同一个样本所归属的节点不同，甚至连类别也可能不同。这充分体现了集成模型的优点，通过 『平均』 来降低误差。如下所示代码为基于决策树的装袋法集成方法在 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 中的两种实现方式：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from  `sklearn` .ensemble import BaggingClassifier,RandomForestClassifier
from  `sklearn` .tree import DecisionTreeClassifier

if __name__ == &#39;__main__&#39;:
    x_train, x_test, y_train, y_test = load_data()

    # 使用装袋分类器
    bagging = BaggingClassifier(n_estimators=5,
                                max_samples=50,
                                max_features=3,
                                bootstrap=True,
                                bootstrap_features=False)
    bagging.fit(x_train, y_train)
    print(bagging.score(x_test, y_test))

  # 直接使用随机森林分类器
    rfc = RandomForestClassifier(n_estimators=5)
    rfc.fit(x_train,y_train)
    print(rfc.score(x_test,y_test))
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="boosting">
<h3>2.2  提升法（<code class="docutils literal notranslate"><span class="pre">Boosting</span></code> ）<a class="headerlink" href="#boosting" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">提升法</span></code>同<code class="docutils literal notranslate"><span class="pre">装袋法</span></code>一样，都用于提高模型的泛化能力。不同的是：<code class="docutils literal notranslate"><span class="pre">提升法</span></code>通过训练一系列串行的模型来达到这一目的。在提升法的一些串行的基模型中，每个基模型都是对前一个基模型输出结果的改善。如果前一个基模型对某些样本进行了错误分类，那么后一个基模型就会针对该错误结果做改善。在经过一系列串行的基模型拟合之后，最终会得到一个更加准确的结果。因此，<strong>提升法经常被用于改善模型高偏差的情况（欠拟合现象）</strong>。</p>
<p><code class="docutils literal notranslate"><span class="pre">提升法</span></code>的工作原理与装袋法相同：构建一系列基模型，然后将这些基模型聚合在一起以获得性能更好的强学习器。然而，与旨在减少方差（过拟合）的装袋法不同，提升法是一种非常适应性的方式串行拟合多个弱学习器的方法：拟合序列中的每个基模型都更加重视数据集中被之前的基模型错误处理的观测数据。直观地说，每个新模型都将精力集中在迄今为止最难拟合的观测数据上，以便在串行过程结束时获得一个具有较低偏差的强学习器。提升法即可用于回归任务，也可用于分类任务。</p>
<p>由于提升法主要专注于减少偏差，因此被考虑用于提升的基模型通常具有低方差和高偏差。例如：如果想使用树作为基模型，我们大多数时候会选择只有很少深度的浅层决策树。另一个促使使用此类弱学习器的重要原因是，这些模型的拟合计算量通常较少。事实上，由于拟合不同模型的计算不能并行完成（与装袋不同），顺序拟合多个复杂模型的代价可能会变得过于昂贵。</p>
<p>选择了弱学习器后，仍然需要定义按照何种顺序拟合（即：我们在拟合当前模型时考虑了来自先前模型的哪些信息？）以及按照什么方式聚合（我们如何聚合当前模型到以前的？）的问题。下面介绍两个重要的提升算法：<code class="docutils literal notranslate"><span class="pre">自适应提升法（Adaboost）</span></code> 和<code class="docutils literal notranslate"><span class="pre">梯度提升法（</span> <span class="pre">Gradient</span> <span class="pre">Boosting）</span></code>。</p>
<p>这两种元算法在顺序过程中创建和聚合弱学习器的方式不同。<code class="docutils literal notranslate"><span class="pre">自适应提升法</span></code>更新附加到每个训练集中观测样本点上的权重，而<code class="docutils literal notranslate"><span class="pre">梯度提升法</span></code>更新这些观测样本的值。这个主要区别来自于两种方法解决优化问题方式的不同。</p>
<p><img alt="" src="https://gitee.com/XiShanSnow/imagebed/raw/master/images/stats-20211221222102-3bec.webp" /></p>
<blockquote>
<div><p>提升法迭代地拟合弱学习器，将其聚合到集成模型并“更新”训练数据集，以便在拟合下一个基本模式时更好地考虑当前集成模型的优势和劣势。</p>
</div></blockquote>
<p><strong>（1）自适应提升</strong></p>
<p>在自适应提升（通常称为“adaboost”）中，我们尝试将集成模型定义为 L 个弱学习器的加权和</p>
<p>寻找具有这种形式的最佳集成模型是一个困难的优化问题。然后，我们不是尝试一次性解决它（找到所有系数和弱学习器，以提供最佳的整体加法模型），而是使用更易于处理的迭代优化过程，即使它可能导致次优解。更特别的是，我们一个一个地添加弱学习器，在每次迭代中寻找最佳的可能对（系数，弱学习器）以添加到当前的集成模型中。换句话说，我们循环定义 (s_l) 使得</p>
<p>其中 c_l 和 w_l 的选择使得 s_l 是最适合训练数据的模型，因此，这是对 s_(l-1) 的最佳改进。然后我们可以表示</p>
<p>其中 E(.) 是给定模型的拟合误差，e(.,.) 是损失/误差函数。因此，我们不是对总和中的所有 L 个模型进行“全局”优化，而是通过优化“局部”构建并将弱学习器逐一添加到强模型中来近似最优。</p>
<p>更特别的是，在考虑二进制分类时，我们可以证明 adaboost 算法可以重写为如下过程。首先，它更新数据集中的观测权重并训练一个新的弱学习器，特别关注当前集成模型错误分类的观测。其次，它根据表达该弱模型性能的更新系数将弱学习器添加到加权和中：弱学习器性能越好，它对强学习器的贡献就越大。</p>
<p>因此，假设我们正面临一个二元分类问题，在我们的数据集中有 N 个观测值，并且我们希望对给定的弱模型系列使用 adaboost 算法。在算法的最开始（序列的第一个模型），所有观测值都具有相同的权重 1/N。然后，我们重复 L 次（对于序列中的 L 个学习者）以下步骤：</p>
<p>用当前的观测权重拟合最好的弱模型
计算更新系数的值，该系数是弱学习器的某种标量评估指标，表明该弱学习器应在集成模型中考虑多少
通过添加新的弱学习器乘以其更新系数来更新强学习器
计算新的观察权重，表示我们希望在下一次迭代中关注哪些观察结果（由聚合模型错误预测的观察权重增加，正确预测观察的权重减少）</p>
<p>重复这些步骤，我们依次构建我们的 L 个模型并将它们聚合成一个简单的线性组合，由表示每个学习器性能的系数加权。请注意，存在初始 adaboost 算法的变体，例如 LogitBoost（分类）或 L2Boost（回归），其主要区别在于它们选择的损失函数。</p>
</div>
<div class="section" id="stacking">
<h3>2.3 堆叠法（  <code class="docutils literal notranslate"><span class="pre">Stacking</span></code> ）<a class="headerlink" href="#stacking" title="Permalink to this headline">¶</a></h3>
<p>与<code class="docutils literal notranslate"><span class="pre">装袋法</span></code>和<code class="docutils literal notranslate"><span class="pre">提升法</span></code>中采用同质基模型的思路不同，堆叠法采用异质基模型。首先通过训练得到多个基于不同算法的基模型，然后再通过训练一个<code class="docutils literal notranslate"><span class="pre">元模型</span></code>来对其它模型的输出结果进行融合。例如：可以选择逻辑回归、朴素贝叶斯和 <code class="docutils literal notranslate"><span class="pre">KNN</span></code> 作为基模型，以决策树作为元模型。 堆叠法首先训练得到前三个基模型；然后再以基模型的输出作为决策树的输入，继续训练元模型；最后以决策树的输出作为最终分类结果。</p>
<p>下代码所示为 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 中实现上述过程的部分代码：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">()</span>
    <span class="n">estimators</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;logist&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">()),</span>
                  <span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">,</span> <span class="n">MultinomialNB</span><span class="p">()),</span>
                  <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">))]</span>
    <span class="n">stacking</span> <span class="o">=</span> <span class="n">StackingClassifier</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="n">estimators</span><span class="p">,</span>
                                  <span class="n">final_estimator</span><span class="o">=</span><span class="n">DecisionTreeClassifier</span><span class="p">(),</span>
                                  <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">stacking</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">stacking</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>2.4 半监督分类任务<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id4">
<h2>3 聚簇任务中的模型集成<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>3.1<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id6">
<h3>3.2<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id7">
<h3>3.3<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id8">
<h2>4 深度集成<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id9">
<h3>4.1 一般性的深度集成<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="snapshot">
<h3>4.1 快照法（ Snapshot ）<a class="headerlink" href="#snapshot" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="fast-geometric-ensembling-fge">
<h3>4.2 快速几何集成法（ fast geometric ensembling, FGE ）<a class="headerlink" href="#fast-geometric-ensembling-fge" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="stochastic-weight-averaging-swa">
<h3>4.3 随机权重平均法（ stochastic weight averaging, SWA ）<a class="headerlink" href="#stochastic-weight-averaging-swa" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="lomifoss">
<h3>4.4 LoMiFoSS<a class="headerlink" href="#lomifoss" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id10">
<h2>6 总结<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>在这篇文章中， 笔者首先通过一个引例大致介绍了什么是集成模型；然后再分别介绍了三种常见的集成模型：装袋法、提升法和 堆叠法，其中对于装袋法和 堆叠法两种集成模型还列举了 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 中的示例用法。本次内容就到此结束，感谢阅读！</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="Append-07-ModelAveraging.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">附录 G：模型平均</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Append-09-BayesianOptimization.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">附录 J：贝叶斯优化</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Osvaldo Martin<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>